var scr=document.getElementsByTagName("script"),zoombox_path=scr[scr.length-1].getAttribute("src").replace("zoombox.js","");!function(o){function e(){"closed"==Y&&(T=!1),Y="load",h(),H.test(w)?(img=new Image,img.src=w,o("body").append('<div id="zoombox_loader"></div>'),o("#zoombox_loader").css("marginTop",z()),y=window.setInterval(function(){l(img)},100)):(m(),a())}function t(){o("body").append(F),o(window).keydown(function(o){b(o.which)}),o(window).resize(function(){d()}),o("#zoombox .zoombox_mask").hide(),o("#zoombox").addClass(k.theme),o("#zoombox .zoombox_mask,.zoombox_close").click(function(){return n(),!1}),0==I?o("#zoombox .zoombox_next,#zoombox .zoombox_prev").remove():(o("#zoombox .zoombox_next").click(function(){s()}),o("#zoombox .zoombox_prev").click(function(){c()}))}function i(){var e=0,t=0;if(k.gallery){if(I===!1)return o("#zoombox .zoombox_gallery").remove(),!1;for(var i in I){var a=zoombox_path+"img/video.png",n=o('<img src="'+a+'" class="video gallery'+1*i+'"/>');H.test(I[i].attr("href"))&&(a=I[i].attr("href"),n=o('<img src="'+a+'" class="gallery'+1*i+'"/>')),n.data("id",i).appendTo("#zoombox .zoombox_gallery"),n.click(function(){r(o(this).data("id")),o("#zoombox .zoombox_gallery img").removeClass("current"),o(this).addClass("current")}),i==O&&n.addClass("current"),o("<img/>").data("img",n).attr("src",a).load(function(){e++;var i=o(this).data("img");if(i.width(Math.round(i.height()*this.width/this.height)),e==o("#zoombox .zoombox_gallery img").length){var a=0;o("#zoombox .zoombox_gallery img").each(function(){a+=o(this).outerWidth(),o(this).data("left",a)});var n=o("<div>").css({position:"absolute",top:0,left:0,width:a});o("#zoombox .zoombox_gallery").wrapInner(n),t=o("#zoombox .zoombox_gallery").width(),o("#zoombox").trigger("change")}})}o("#zoombox .zoombox_gallery").show().animate({bottom:0},k.duration)}o("#zoombox").bind("change",function(e,t){if(o("#zoombox .zoombox_gallery div").width()<o("#zoombox .zoombox_gallery").width)return!0;var i=0,a=0;null!=t?(i=k.duration,a=t.width/2):a=o("#zoombox .zoombox_gallery").width()/2;var n=-o("#zoombox .zoombox_gallery img.current").data("left")+o("#zoombox .zoombox_gallery img.current").width()/2,m=n+a;m<2*a-o("#zoombox .zoombox_gallery div").width()&&(m=2*a-o("#zoombox .zoombox_gallery div").width()),m>0&&(m=0),o("#zoombox .zoombox_gallery div").animate({left:m},i)})}function a(){if(0==T?t():o("#zoombox .zoombox_title").empty(),o("#zoombox .close").hide(),o("#zoombox .zoombox_container").removeClass("multimedia").removeClass("img").addClass(C),null!=f&&f.attr("title")&&o("#zoombox .zoombox_title").append(f.attr("title")),o("#zoombox .zoombox_content").empty(),"img"==C&&0==T&&1==k.animation&&o("#zoombox .zoombox_content").append(_),null!=f&&0!=f.find("img").length&&0==T){var e=f.find("img");o("#zoombox .zoombox_container").css({width:e.width(),height:e.height(),top:e.offset().top,left:e.offset().left,opacity:0,marginTop:e.css("marginTop")})}else null!=f&&0==T?o("#zoombox .zoombox_container").css({width:f.width(),height:f.height(),top:f.offset().top,left:f.offset().left}):0==T&&o("#zoombox .zoombox_container").css({width:100,height:100,top:x()/2-50,left:p()/2-50});var a={width:g,height:v,left:(p()-g)/2,top:(x()-v)/2,marginTop:z(),opacity:1};o("#zoombox").trigger("change",a),1==k.animation?(o("#zoombox .zoombox_title").hide(),o("#zoombox .zoombox_close").hide(),o("#zoombox .zoombox_container").animate(a,k.duration,function(){("multimedia"==C||1==T)&&o("#zoombox .zoombox_content").append(_),("image"==C||1==T)&&o("#zoombox .zoombox_content img").css("opacity",0).fadeTo(300,1),o("#zoombox .zoombox_title").fadeIn(300),o("#zoombox .zoombox_close").fadeIn(300),Y="opened",T||i(),T=!0}),o("#zoombox .zoombox_mask").fadeTo(200,k.opacity)):(o("#zoombox .zoombox_content").append(_),o("#zoombox .zoombox_close").show(),o("#zoombox .zoombox_gallery").show(),o("#zoombox .zoombox_container").css(a),o("#zoombox .zoombox_mask").show(),o("#zoombox .zoombox_mask").css("opacity",k.opacity),T||i(),T=!0,Y="opened")}function n(){Y="closing",window.clearInterval(y),o(window).unbind("keydown"),o(window).unbind("resize"),"multimedia"==C&&o("#zoombox .zoombox_container").empty();var e={};if(null!=f&&f.find("img").length>0){var t=f.find("img");e={width:t.width(),height:t.height(),top:t.offset().top,left:t.offset().left,opacity:0,marginTop:t.css("marginTop")}}else e=null!=f?{width:f.width(),height:f.height(),top:f.offset().top,left:f.offset().left,marginTop:0,opacity:0}:{width:100,height:100,top:x()/2-50,left:p()/2-50,opacity:0};1==k.animation?(o("#zoombox .zoombox_mask").fadeOut(200),o("#zoombox .zoombox_gallery").animate({bottom:-o("#zoombox .zoombox_gallery").innerHeight()},k.duration),o("#zoombox .zoombox_container").animate(e,k.duration,function(){o("#zoombox").remove(),Y="closed",T=!1})):(o("#zoombox").remove(),Y="closed",T=!1)}function m(){0==k.overflow&&(1*g+50>p()&&(v=(p()-50)*v/g,g=p()-50),1*v+50>x()&&(g=(x()-50)*g/v,v=x()-50));var o=w;if(C="multimedia",H.test(o))C="img",_='<img src="'+w+'" width="100%" height="100%"/>';else if(P.test(o))g=300,v=40,_='<object type="application/x-shockwave-flash" data="'+MP3Player+"?son="+o+'" width="'+g+'" height="'+v+'">',_+='<param name="movie" value="'+MP3Player+"?son="+o+'" /></object>';else if(A.test(o)){var e=0;1==k.autoplay&&(e=1),_='<object type="application/x-shockwave-flash" data="'+zoombox_path+'FLVplayer.swf" width="'+g+'" height="'+v+'"><param name="allowFullScreen" value="true"><param name="scale" value="noscale"><param name="wmode" value="transparent"><param name="flashvars" value="flv='+o+"&autoplay="+e+'"><embed src="'+zoombox_path+'FLVplayer.swf" width="'+g+'" height="'+v+'" allowscriptaccess="always" allowfullscreen="true" flashvars="flv='+o+'" wmode="transparent" /></object>'}else if(E.test(o))_='<object width="'+g+'" height="'+v+'"><param name="allowfullscreen" value="true" /><param name="allowscriptaccess" value="always" /><param name="movie" value="'+o+'" /><embed src="'+o+'" type="application/x-shockwave-flash" allowfullscreen="true" allowscriptaccess="always" width="'+g+'" height="'+v+'" wmode="transparent"></embed></object>';else if(M.test(o))_='<embed src="'+o+'" width="'+g+'" height="'+v+'" controller="true" cache="true" autoplay="true"/>';else if(W.test(o))_='<embed src="'+o+'" width="'+g+'" height="'+v+'" controller="true" cache="true" autoplay="true" wmode="transparent" />';else if(q.test(o)){var t=o.split("_");t=t[0].split("/"),t=t[t.length-1]+"?",1==k.autoplay&&(t+="autoPlay=1&"),_='<iframe frameborder="0" width="'+g+'" height="'+v+'" src="http://www.dailymotion.com/embed/video/'+t+'?wmode=transparent"></iframe>'}else if(L.test(o)){var t=o.split("/");t=t[3]+"?",1==k.autoplay&&(t+="autoplay=1&"),_='<iframe src="http://player.vimeo.com/video/'+t+'title=0&byline=0&portrait=0&wmode=transparent" width="'+g+'" height="'+v+'" frameborder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>'}else if(S.test(o)){var t=o.split("watch?v=");t=t[1].split("&"),t=t[0]+"?",1==k.autoplay&&(t+="autoplay=1&"),_='<iframe width="'+g+'" height="'+v+'" src="http://www.youtube.com/embed/'+t+'wmode=Opaque" frameborder="0" allowfullscreen></iframe>'}else V.test(o)?(o=o.split(".html"),o=o[0],_='<object type="application/x-shockwave-flash" data="'+o+'" width="'+g+'" height="'+v+'"><param name="movie" value="'+o+'"><embed src="'+o+'" type="application/x-shockwave-flash" width="'+g+'" height="'+v+'"  wmode="transparent"></embed></object>'):_='<iframe src="'+o+'" width="'+g+'" height="'+v+'" border="0"></iframe>';return _}function l(e){e.complete&&(j=0,window.clearInterval(y),g=e.width,v=e.height,o("#zoombox_loader").remove(),m(),a()),o("#zoombox_loader").css({"background-position":"0px "+j+"px"}),j-=40,-440>j&&(j=0)}function r(t){return"opened"!=Y?!1:(I&&(O=t,f=I[O],w=f.attr("href"),o("#zoombox .zoombox_gallery img").length>0&&(o("#zoombox .zoombox_gallery img").removeClass("current"),o("#zoombox .zoombox_gallery img:eq("+t+")").addClass("current")),e()),!1)}function s(){j=O+1,j>I.length-1&&(j=0),r(j)}function c(){j=O-1,0>j&&(j=I.length-1),r(j)}function d(){o("#zoombox .zoombox_container").css({top:(x()-o("#zoombox .zoombox_container").outerHeight(!0))/2,left:(p()-o("#zoombox .zoombox_container").outerWidth(!0))/2})}function b(o){37==o&&c(),39==o&&s(),27==o&&n()}function h(){if(g=k.width,v=k.height,null!=f){var o=/w([0-9]+)/,e=o.exec(f.attr("class"));null!=e&&e[1]&&(g=e[1]);var t=/h([0-9]+)/,i=t.exec(f.attr("class"));null!=i&&i[1]&&(v=i[1])}return!1}function x(){return window.innerHeight?window.innerHeight:o(window).height()}function p(){return window.innerWidth?window.innerWidth:o(window).width()}function z(){return scrOfY=0,"number"==typeof window.pageYOffset?scrOfY=window.pageYOffset:document.body&&document.body.scrollTop?scrOfY=document.body.scrollTop:document.documentElement&&document.documentElement.scrollTop&&(scrOfY=document.documentElement.scrollTop),scrOfY}var u,f,w,g,v,y,_,k={theme:"zoombox",opacity:.8,duration:800,animation:!0,width:600,height:400,gallery:!0,autoplay:!1,overflow:!1},T=!1,j=0,C="multimedia",O=!1,I=!1,Y="closed",F='<div id="zoombox">             <div class="zoombox_mask"></div>            <div class="zoombox_container">                <div class="zoombox_content"></div>                <div class="zoombox_title"></div>                <div class="zoombox_next"></div>                <div class="zoombox_prev"></div>                <div class="zoombox_close"></div>            </div>            <div class="zoombox_gallery"></div>        </div>',H=/(\.jpg)|(\.jpeg)|(\.bmp)|(\.gif)|(\.png)/i,P=/(\.mp3)/i,A=/(\.flv)/i,E=/(\.swf)/i,M=/(\.mov)|(\.mp4)/i,W=/(\.wmv)|(\.avi)/i,q=/(http:\/\/www.dailymotion)|(http:\/\/dailymotion)/i,L=/(http:\/\/www.vimeo)|(http:\/\/vimeo)/i,S=/(youtube\.)/i,V=/(http:\/\/www\.koreus)|(http:\/\/koreus)/i;o.zoombox=function(){},o.zoombox.options=k,o.zoombox.close=function(){n()},o.zoombox.open=function(t,i){f=null,w=t,k=o.extend({},o.zoombox.options,i),e()},o.zoombox.html=function(e,t){_=e,k=o.extend({},o.zoombox.options,t),g=k.width,v=k.height,f=null,a()},o.fn.zoombox=function(t){return u=new Array,this.each(function(){if(o.browser&&o.browser.msie&&o.browser.version<7&&!window.XMLHttpRequest)return!1;var i=this,a=/zgallery([0-9]+)/,n=/zskip/,m=a.exec(o(this).attr("class")),l=n.exec(o(this).attr("class")),r=!1;if(null!=m){u[m[1]]||(u[m[1]]=new Array),null==l&&u[m[1]].push(o(this));var s=u[m[1]].length-1;r=u[m[1]]}o(this).unbind("click").click(function(){return k=o.extend({},o.zoombox.options,t),"closed"!=Y?!1:(null!=l?s<u[m[1]].length-1&&(f=u[m[1]][s+1]):f=o(i),I=r,w=f.attr("href"),O=s,e(),!1)})})}}(jQuery);